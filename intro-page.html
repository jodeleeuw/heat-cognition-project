<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Are you colorblind?</title>
    <script src="jatos.js"></script>
    <script src="https://unpkg.com/jspsych@8.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych/css/jspsych.css">
    <link rel="stylesheet" href="src/styles.css">

</head>

<body></body>
<script>

    const jsPsych = initJsPsych({
        on_finish: () => jatos.startComponentByTitle(jatos.studySessionData.trial_list.shift()), // Start next task
    });

    const ask = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<p><h1>Before we start the task</h1>Are you colorblind?</p>',
        choices: ['Yes', 'No'],
        on_finish: function(data) {
            // Make list of tasks based on colorblindness
            let trial_list = [];
            // If colorblind, no stroop task
            if (data.response === 0) {
                trial_list = ['Go/No-Go', 'Spatial N-back', 'CART'];
                jatos.studySessionData.colorblind = 'yes'; // Store colorblindness info

            } else {
                trial_list = ['Go/No-Go', 'Spatial N-back',  'CART', 'Stroop'];
            }

            jsPsych.randomization.shuffle(trial_list); // Shuffle order of tasks
            trial_list = trial_list.slice(0, 2); // Keep only first two elements
            trial_list.push('Survey'); // Always end with survey
            jatos.studySessionData.trial_list = trial_list;
        }
    };

    jatos.onLoad(() => {
        jsPsych.run([ask]);
    });
</script>

</html>