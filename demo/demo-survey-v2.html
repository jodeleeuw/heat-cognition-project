<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HotCog Demo</title>
    <script src="https://unpkg.com/jspsych@8"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-survey-slider"></script>
    <script src="https://unpkg.com/@jspsych/plugin-browser-check"></script>
    <script src="https://unpkg.com/@jspsych/plugin-call-function"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/jspsych@8.2.2/css/jspsych.css"
    />
    <script src="https://unpkg.com/@jspsych/plugin-survey@4.0.0"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@jspsych/plugin-survey@4.0.0/css/survey.min.css"
    />
    <script src="../survey/survey-text.js"></script>
    <script src="../survey/survey-items.js"></script>
    <script src="../utility/utility-trials.js"></script>
    <script src="jatos.js"></script>
    <link rel="stylesheet" href="../survey/survey.css">
    <style>
      html { 
        background-color: #f5f5f5;
      } 
    </style>
  </head>
  <body>
    <script>
      // todo: randomize order of survey pages (will get paths through)
      // validation/pre-pilot: questionnaire on one
      // get launched for JATOS

      // by november:
      // -- whole package ready to go
      // -- all the tasks working, paths up

      const IN_JATOS = typeof jatos !== "undefined";

      const jsPsych = initJsPsych({
        on_finish: function () {
          if (IN_JATOS) {
            jatos.startNextComponent(jsPsych.data.get().json())
          } else {
            jsPsych.data.displayData();
          }
        },
        on_trial_finish: function (data) {
          const ts = new Date();
          data.timestamp = ts.toISOString();
          data.timestamp_local = ts.toLocaleTimeString();
        }
      });

      let timeline = [];

      timeline.push(intro_trial);
      timeline.push(ip_check);
      timeline.push(browser_check);
      timeline.push(consent_trial);
      timeline.push(location_trial);
      timeline.push(work_conditions_trial);
      timeline.push(health_conditions_trial);
      timeline.push(chronic_pain_trial);
      timeline.push(who5_trial);
      timeline.push(phq4_trial);
      timeline.push(vams_trial);
      timeline.push(bpaq_trial);
      timeline.push(ac_trial);
      timeline.push(loneliness_trial);
      timeline.push(resilience_trial);
      timeline.push(svo_trials);
      timeline.push(tic_trial);
      timeline.push(cce_trial);
      timeline.push(ccj_trial);
      timeline.push(cca_trial);
      timeline.push(ccb_trial);
      timeline.push(ts_trial);
      timeline.push(sta_trial);
      timeline.push(sl_trial);
      timeline.push(green_blue_spaces_trial);
      timeline.push(ac_access_trial);
      timeline.push(housing_conditions_trial);
      timeline.push(heat_actions_trial);
      timeline.push(de_trial);
      timeline.push(final_comments_trial);

      if (IN_JATOS) {
        const jatos_id = jatos.studyResultId;
        jsPsych.data.addProperties({ jatos_id: jatos_id });
        jatos.onLoad(() => {
          jsPsych.run(timeline);
        });
      } else {
        jsPsych.run(timeline);
      }
      
    </script>
  </body>
</html>
