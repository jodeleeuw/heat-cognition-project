<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Are you colorblind?</title>
    <script src="jatos.js"></script>
    <script src="https://unpkg.com/jspsych@8.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych/css/jspsych.css">
    <link rel="stylesheet" href="src/styles.css">

</head>

<body></body>
<script>

    const jsPsych = initJsPsych({
        // on_finish: () => jsPsych.data.displayData('json'),
        on_finish: () => {}
    });

    const ask = {
        type: jsPsychHtmlButtonResponse,
        stimulus: '<p>Are you colorblind?</p>',
        choices: ['Yes', 'No'],
        on_finish: function(data) {
            data.colorblind = data.response === 0 ? 'yes' : 'no';
            
            // Define task pools based on colorblind status
            const colorblindTasks = ['columbia-card', 'go-nogo', 'spatial-nback'];
            const nonColorblindTasks = ['columbia-card', 'go-nogo', 'spatial-nback', 'stroop-task'];
            
            // Select appropriate task pool
            const taskPool = data.colorblind === 'yes' ? colorblindTasks : nonColorblindTasks;
            
            // Randomly shuffle and select 2 tasks
            const shuffledTasks = taskPool.sort(() => Math.random() - 0.5);
            const selectedTasks = shuffledTasks.slice(0, 2);
            
            // Store task sequence in JATOS batch session data
            const batchData = {
                colorblind: data.colorblind,
                taskSequence: selectedTasks,
                currentTaskIndex: 0
            };
            
            jatos.batchSession.set('experimentData', batchData, function() {
                // Start first selected task
                jatos.startComponentByTitle(selectedTasks[0]);
            });
        }
    };

    
    jatos.onLoad(() => {
        jsPsych.run([ask]);
    });
</script>

</html>